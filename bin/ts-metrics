#!/usr/bin/env bash
# typescript-metrics CLI - TypeScript code complexity analyzer
# This is the main executable for the npm package
set -euo pipefail

# Find the package directory where run.sh is located
if [ -n "${npm_package_parentdir:-}" ]; then
  # Running via npm (global or local)
  PACKAGE_DIR="$npm_package_parentdir/typescript-metrics"
elif [ -n "${npm_config_prefix:-}" ]; then
  # Fallback: use npm prefix
  PACKAGE_DIR="$npm_config_prefix/lib/node_modules/typescript-metrics"
else
  # Fallback: try to find via npm root
  NPM_ROOT="$(npm root -g 2>/dev/null || echo '')"
  if [ -n "$NPM_ROOT" ]; then
    PACKAGE_DIR="$NPM_ROOT/typescript-metrics"
  else
    # Last resort: relative path (works for local development)
    SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
    PACKAGE_DIR="$SCRIPT_DIR/.."
  fi
fi

# Verify run.sh exists
RUN_SCRIPT="$PACKAGE_DIR/run.sh"
if [ ! -f "$RUN_SCRIPT" ]; then
  echo "Error: Cannot find run.sh at $RUN_SCRIPT" >&2
  echo "Try reinstalling: npm install -g typescript-metrics" >&2
  exit 1
fi

# Run the main script
exec "$RUN_SCRIPT" "$@"
