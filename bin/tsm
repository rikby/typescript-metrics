#!/usr/bin/env bash
# tsm - Shorthand alias for typescript-metrics CLI
# This is a convenience wrapper that delegates to the main binary
set -euo pipefail

# Find the package directory where ts-metrics is located
if [ -n "${npm_package_parentdir:-}" ]; then
  # Running via npm (global or local)
  PACKAGE_DIR="$npm_package_parentdir/typescript-metrics"
elif [ -n "${npm_config_prefix:-}" ]; then
  # Fallback: use npm prefix
  PACKAGE_DIR="$npm_config_prefix/lib/node_modules/typescript-metrics"
else
  # Fallback: try to find via npm root
  NPM_ROOT="$(npm root -g 2>/dev/null || echo '')"
  if [ -n "$NPM_ROOT" ]; then
    PACKAGE_DIR="$NPM_ROOT/typescript-metrics"
  else
    # Last resort: relative path (works for local development)
    SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
    PACKAGE_DIR="$SCRIPT_DIR/.."
  fi
fi

# Verify ts-metrics exists
TS_METRICS_BIN="$PACKAGE_DIR/bin/ts-metrics"
if [ ! -f "$TS_METRICS_BIN" ]; then
  echo "Error: Cannot find ts-metrics at $TS_METRICS_BIN" >&2
  echo "Try reinstalling: npm install -g typescript-metrics" >&2
  exit 1
fi

# Run the main ts-metrics script with all arguments passed through
exec "$TS_METRICS_BIN" "$@"
